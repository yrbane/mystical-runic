{{extends "base.html"}}

{{block title}}{{t "shop_title"}} - {{super}}{{/block}}

{{block content}}
<!-- ğŸ”® TOUTES LES FONCTIONNALITÃ‰S DE MYSTICAL-RUNIC EN ACTION! -->

<!-- ğŸŒ INTERNATIONALIZATION (i18n) -->
<section id="i18n">
    <h2>ğŸŒ {{t "section.internationalization"}}</h2>
    <p>{{t "current_locale_info"}}: <strong>{{locale}}</strong></p>
    <p>{{t "user_greeting" name=user.name role=user.role}}</p>
    <p>{{t "site_description" site_name=site.name}}</p>
</section>

<!-- ğŸ“ PLURALIZATION SYSTÃˆME -->
<section id="pluralization">
    <h2>ğŸ“ {{t "section.pluralization"}}</h2>
    <div class="stats">
        <div class="stat">
            <h3>{{cart.total_items}}</h3>
            <p>{{plural cart.total_items "article" "articles"}} {{t "in_cart"}}</p>
        </div>
        <div class="stat">
            <h3>{{stats.total_products}}</h3>
            <p>{{plural stats.total_products "produit" "produits"}} {{t "available"}}</p>
        </div>
        <div class="stat">
            <h3>{{stats.total_users}}</h3>
            <p>{{plural stats.total_users "utilisateur" "utilisateurs"}} {{t "registered"}}</p>
        </div>
    </div>
</section>

<!-- ğŸ”¢ ADVANCED MATH FILTERS -->
<section id="math-filters" class="filter-demo">
    <h2>ğŸ”¢ {{t "section.math_filters"}}</h2>
    <p><strong>{{t "cart_subtotal"}}:</strong> {{cart.subtotal|currency}}</p>
    <p><strong>{{t "tax_rate"}}:</strong> {{tax.rate|multiply:100|round:1}}%</p>
    <p><strong>{{t "tax_amount"}}:</strong> {{cart.subtotal|multiply:tax.rate|currency}}</p>
    <p><strong>{{t "total_amount"}}:</strong> {{cart.subtotal|add:cart.subtotal|multiply:tax.rate|currency}}</p>
    <p><strong>{{t "discount_percent"}}:</strong> {{user.discount|multiply:100|percentage}}</p>
    <p><strong>{{t "savings"}}:</strong> {{cart.subtotal|multiply:user.discount|currency}}</p>
</section>

<!-- ğŸ¨ CUSTOM FILTERS & CHAINING -->
<section id="custom-filters" class="filter-demo">
    <h2>ğŸ¨ {{t "section.custom_filters"}}</h2>
    <p><strong>{{t "username"}}:</strong> {{user.name|upper|truncate:10}}</p>
    <p><strong>{{t "bio"}}:</strong> {{user.bio|markdown|truncate:50}}</p>
    <p><strong>{{t "join_date"}}:</strong> {{user.join_date|date:"Y-m-d"}}</p>
    <p><strong>{{t "encrypted_id"}}:</strong> {{user.id|encrypt}}</p>
</section>

<!-- ğŸ—ï¸ TEMPLATE INHERITANCE & SUPER -->
<section id="inheritance">
    <h2>ğŸ—ï¸ {{t "section.template_inheritance"}}</h2>
    <p>{{t "inheritance_explanation"}}</p>
    <div class="card">
        <h3>{{t "base_template_features"}}</h3>
        <ul>
            <li>{{t "feature.header"}}</li>
            <li>{{t "feature.navigation"}}</li>  
            <li>{{t "feature.footer"}}</li>
            <li>{{t "feature.styling"}}</li>
        </ul>
    </div>
</section>

<!-- ğŸ“¦ REUSABLE MACROS SYSTEM -->
{{macro product_card(name, price, sale_price, rating, stock)}}
<div class="card macro-demo">
    <h4>ğŸ”® {{name|upper}}</h4>
    <div class="price">
        {{if sale_price}}
            <span class="sale">{{t "sale"}}!</span>
            <del>{{price|currency}}</del> 
            <strong>{{sale_price|currency}}</strong>
            <small>({{price|divide:sale_price|multiply:100|round:0}}% {{t "off"}})</small>
        {{else}}
            <strong>{{price|currency}}</strong>
        {{/if}}
    </div>
    <p>â­ {{rating}}/5 | ğŸ“¦ {{plural stock "en stock" "en stock"}}</p>
</div>
{{/macro}}

<section id="macros">
    <h2>ğŸ“¦ {{t "section.reusable_macros"}}</h2>
    <p>{{t "macro_explanation"}}</p>
    
    <!-- Utilisation des macros avec diffÃ©rents paramÃ¨tres -->
    {{product_card("Grimoire Magique", 29.99, 19.99, 4.8, 12)}}
    {{product_card("Potion de Code", 15.50, "", 4.2, 7)}}
    {{product_card("Rune USB 3.0", 45.00, 35.00, 4.9, 3)}}
</section>

<!-- ğŸ”„ NESTED LOOPS (NOUVELLEMENT IMPLÃ‰MENTÃ‰!) -->
<section id="nested-loops" class="nested-demo">
    <h2>ğŸ”„ {{t "section.nested_loops"}}</h2>
    <p>{{t "nested_loops_explanation"}}</p>
    
    <h3>{{t "product_categories"}}</h3>
    {{for category in categories}}
        <div class="card">
            <h4>ğŸ“ {{category.name}} ({{plural category.products.length "produit" "produits"}})</h4>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px;">
                {{for product in category.products}}
                    <div style="border: 1px solid #ccc; padding: 10px; border-radius: 3px;">
                        <strong>{{product.name}}</strong><br>
                        <span class="price">{{product.price|currency}}</span><br>
                        <small>â­ {{product.rating}}/5</small>
                    </div>
                {{/for}}
            </div>
        </div>
    {{/for}}
</section>

<!-- ğŸ”„ NESTED INCLUDES (NOUVELLEMENT IMPLÃ‰MENTÃ‰!) -->
<section id="nested-includes" class="nested-demo">
    <h2>ğŸ”„ {{t "section.nested_includes"}}</h2>
    <p>{{t "nested_includes_explanation"}}</p>
    
    <div class="card">
        <h3>{{t "user_profile_card"}}</h3>
        {{include "components/user_profile.html"}}
    </div>
    
    <div class="card">
        <h3>{{t "blog_posts"}}</h3>
        {{include "components/blog_section.html"}}
    </div>
</section>

<!-- ğŸ›¡ï¸ SECURITY FEATURES (PATH TRAVERSAL PROTECTION) -->
<section id="security" class="security-demo">
    <h2>ğŸ›¡ï¸ {{t "section.security_features"}}</h2>
    <p>{{t "security_explanation"}}</p>
    
    <div class="card">
        <h4>âœ… {{t "security.xss_protection"}}</h4>
        <p>{{t "user_input"}}: {{user_input}}</p>
        <p>{{t "raw_input"}}: {{& user_input_safe}}</p>
    </div>
    
    <div class="card">
        <h4>âœ… {{t "security.path_traversal_protection"}}</h4>
        <p>{{t "security.path_explanation"}}</p>
        <ul>
            <li>âœ… {{t "security.blocked_patterns"}}: <code>../</code>, <code>..\</code></li>
            <li>âœ… {{t "security.blocked_absolute"}}: <code>/etc/passwd</code></li>
            <li>âœ… {{t "security.blocked_drive"}}: <code>C:\Windows</code></li>
        </ul>
    </div>
</section>

<!-- ğŸŒŠ DEEP DOT NOTATION -->
<section id="deep-dot">
    <h2>ğŸŒŠ {{t "section.deep_dot_notation"}}</h2>
    <div class="card">
        <h4>{{t "user_deep_profile"}}</h4>
        <p><strong>{{t "name"}}:</strong> {{user.profile.personal.full_name}}</p>
        <p><strong>{{t "location"}}:</strong> {{user.profile.location.city}}, {{user.profile.location.country}}</p>
        <p><strong>{{t "preferences"}}:</strong> {{user.profile.settings.theme}} {{t "theme"}}, {{user.profile.settings.language}} {{t "language"}}</p>
        <p><strong>{{t "level"}}:</strong> {{user.gaming.stats.level}} ({{user.gaming.stats.xp}} XP)</p>
        <p><strong>{{t "achievements"}}:</strong> {{user.gaming.achievements.0.name}}, {{user.gaming.achievements.1.name}}</p>
    </div>
</section>

<!-- âš¡ PERFORMANCE FEATURES -->
<section id="performance">
    <h2>âš¡ {{t "section.performance_features"}}</h2>
    <div class="stats">
        <div class="stat">
            <h3>ğŸ“Š {{t "template_caching"}}</h3>
            <p>{{t "cache_status"}}: âœ… {{t "enabled"}}</p>
        </div>
        <div class="stat">
            <h3>ğŸš€ {{t "bytecode_compilation"}}</h3>
            <p>{{t "bytecode_status"}}: âœ… {{t "active"}}</p>
        </div>
        <div class="stat">
            <h3>ğŸ”„ {{t "parallel_processing"}}</h3>
            <p>{{t "parallel_status"}}: âœ… {{t "available"}}</p>
        </div>
    </div>
</section>

<!-- ğŸ­ DUAL NAMING SYSTEM -->
<section id="naming">
    <h2>ğŸ­ {{t "section.dual_naming"}}</h2>
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
        <div class="card">
            <h4>ğŸ¢ {{t "professional_style"}}</h4>
            <ul>
                <li><code>TemplateEngine</code></li>
                <li><code>TemplateContext</code></li>
                <li><code>TemplateValue</code></li>
                <li><code>FilterFunction</code></li>
            </ul>
        </div>
        <div class="card">
            <h4>ğŸ”® {{t "mystical_style"}}</h4>
            <ul>
                <li><code>RuneEngine</code></li>
                <li><code>RuneScroll</code></li>
                <li><code>RuneSymbol</code></li>
                <li><code>MysticFilter</code></li>
            </ul>
        </div>
    </div>
</section>

{{/block}}